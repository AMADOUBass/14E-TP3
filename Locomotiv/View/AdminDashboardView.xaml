<UserControl
  x:Class="Locomotiv.View.AdminDashboardView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:gmap="clr-namespace:GMap.NET.WindowsPresentation;assembly=GMap.NET.WindowsPresentation"
  mc:Ignorable="d"
  Loaded="AdminDashboardView_Loaded"
  d:DesignHeight="600"
  d:DesignWidth="1000"
>
  <UserControl.Resources>
    <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    <SolidColorBrush x:Key="AccentBrush" Color="#34495E" />
    <SolidColorBrush x:Key="LightBackground" Color="#F4F6F7" />

    <Style TargetType="TextBlock" x:Key="LabelStyle">
      <Setter Property="FontWeight" Value="Bold" />
      <Setter Property="Foreground" Value="{StaticResource AccentBrush}" />
      <Setter Property="Margin" Value="0,2,0,2" />
    </Style>

    <Style TargetType="GroupBox">
      <Setter Property="BorderBrush" Value="{StaticResource AccentBrush}" />
      <Setter Property="Foreground" Value="{StaticResource AccentBrush}" />
      <Setter Property="FontWeight" Value="Bold" />
      <Setter Property="Background" Value="{StaticResource LightBackground}" />
    </Style>

    <Style TargetType="Button">
      <Setter Property="Background" Value="{StaticResource AccentBrush}" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="FontWeight" Value="Bold" />
      <Setter Property="Padding" Value="5,2" />
      <Setter Property="Margin" Value="5" />
    </Style>
  </UserControl.Resources>

  <Grid Margin="20">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <StackPanel Grid.Row="0" Margin="0,0,0,20">
      <!-- 📍 Point d’intérêt -->
      <GroupBox
        Header="Point d’intérêt sélectionné"
        Margin="0,10,0,10"
        Visibility="{Binding EstPointInteretSelectionne, Converter={StaticResource BoolToVisibilityConverter}}"
      >
        <StackPanel>
          <TextBlock FontSize="16" Style="{StaticResource LabelStyle}">
            <TextBlock.Text>
              <MultiBinding StringFormat="Le point d’intérêt « {0} » est situé vers {1}">
                <Binding Path="PointInteretSelectionne.Nom" />
                <Binding Path="PointInteretSelectionne.Localisation" />
              </MultiBinding>
            </TextBlock.Text>
          </TextBlock>
        </StackPanel>
      </GroupBox>

      <!-- 🏢 Station sélectionnée -->
      <GroupBox Header="Station sélectionnée" Margin="0,10,0,10">
        <StackPanel>
          <TextBlock
            Text="{Binding StationSelectionnee.Nom}"
            FontSize="16"
            Style="{StaticResource LabelStyle}"
          />
          <TextBlock Text="Capacité maximale :" Style="{StaticResource LabelStyle}" />
          <TextBlock Text="{Binding StationSelectionnee.CapaciteMaxTrains}" />
          <TextBlock Text="Localisation :" Style="{StaticResource LabelStyle}" />
          <TextBlock Text="{Binding StationSelectionnee.Localisation}" />

          <Button Content="Afficher les conflits" Click="AfficherConflits_Click" />
          <Button Content="Rafraîchir les conflits" Click="RafraichirConflits_Click" />

          <GroupBox Header="Conflits détectés" Margin="10" Padding="5">
            <ListBox
              ItemsSource="{Binding ConflitsTextuels}"
              Background="LightYellow"
              BorderBrush="DarkRed"
              BorderThickness="2"
              FontWeight="Bold"
              Foreground="DarkRed"
              Padding="5"
            />
          </GroupBox>

          <GroupBox Header="Conflits liés à la station sélectionnée" Margin="10">
            <ListBox
              ItemsSource="{Binding ConflitsDeLaStationSelectionnee}"
              Background="LightYellow"
              BorderBrush="DarkOrange"
              BorderThickness="2"
              FontWeight="Bold"
              Foreground="DarkRed"
              Padding="5"
            />
          </GroupBox>
        </StackPanel>
      </GroupBox>

      <!-- 🚆 Trains liés -->
      <TextBlock
        Text="Trains liés à cette station :"
        Style="{StaticResource LabelStyle}"
        Margin="0,10,0,5"
      />
      <ItemsControl ItemsSource="{Binding TrainsDeLaStationSelectionnee}">
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
              <TextBlock>
                <TextBlock.Style>
                  <Style TargetType="TextBlock">
                    <Setter Property="Text" Value="{Binding Etat}" />
                    <Style.Triggers>
                      <DataTrigger Binding="{Binding Etat}" Value="EnGare">
                        <Setter Property="Text" Value="🟢" />
                      </DataTrigger>
                      <DataTrigger Binding="{Binding Etat}" Value="EnTransit">
                        <Setter Property="Text" Value="🚆" />
                      </DataTrigger>
                      <DataTrigger Binding="{Binding Etat}" Value="EnAttente">
                        <Setter Property="Text" Value="⏳" />
                      </DataTrigger>
                      <DataTrigger Binding="{Binding Etat}" Value="HorsService">
                        <Setter Property="Text" Value="❌" />
                      </DataTrigger>
                      <DataTrigger Binding="{Binding Etat}" Value="Programme">
                        <Setter Property="Text" Value="📅" />
                      </DataTrigger>
                    </Style.Triggers>
                  </Style>
                </TextBlock.Style>
              </TextBlock>
              <TextBlock Text=" " />
              <TextBlock Text="{Binding Nom}" FontSize="14" />
            </StackPanel>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>

      <!-- 🛠️ Boutons -->
      <StackPanel Orientation="Horizontal" Margin="0,10,0,10">
        <Button Content="Ajouter un train" Command="{Binding AjouterTrainCommand}" />
        <Button Content="Supprimer un train" Command="{Binding SupprimerTrainCommand}" />
        <Button Content="Planifier un itinéraire" Command="{Binding PlanifierItineraireCommand}" />
      </StackPanel>

      <!-- ⚠️ Erreurs -->
      <TextBlock
        Text="{Binding ErrorMessages}"
        Foreground="Red"
        HorizontalAlignment="Center"
        Margin="10"
      />

      <!-- 🗺️ Carte -->
      <gmap:GMapControl x:Name="MapControl" Grid.Row="1" Width="1200" Height="700" />
    </StackPanel>
  </Grid>
</UserControl>
