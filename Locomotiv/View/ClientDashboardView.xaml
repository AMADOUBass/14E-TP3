<UserControl
  x:Class="Locomotiv.View.ClientDashboardView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  mc:Ignorable="d"
  xmlns:local="clr-namespace:Locomotiv"
>
  <UserControl.Resources>
    <!-- Thème -->
    <SolidColorBrush x:Key="AccentBrush" Color="#34495E" />
    <SolidColorBrush x:Key="LightBackground" Color="#F4F6F7" />

    <!-- Styles -->
    <Style TargetType="TextBlock" x:Key="LabelStyle">
      <Setter Property="FontWeight" Value="Bold" />
      <Setter Property="Margin" Value="0,2,5,0" />
      <Setter Property="Foreground" Value="{StaticResource AccentBrush}" />
    </Style>

    <Style TargetType="GroupBox">
      <Setter Property="BorderBrush" Value="{StaticResource AccentBrush}" />
      <Setter Property="Foreground" Value="{StaticResource AccentBrush}" />
      <Setter Property="FontWeight" Value="Bold" />
      <Setter Property="Background" Value="{StaticResource LightBackground}" />
    </Style>

    <!-- Badge Statut : couleurs par triggers -->
    <DataTemplate x:Key="StatusTemplate">
      <Border CornerRadius="6" Padding="6,3" Margin="2">
        <TextBlock Text="{Binding Status}" Foreground="White" FontWeight="Bold" />
        <Border.Style>
          <Style TargetType="Border">
            <Setter Property="Background" Value="#7F8C8D" />
            <Style.Triggers>
              <DataTrigger Binding="{Binding Status}" Value="Planifié">
                <Setter Property="Background" Value="#2980B9" />
              </DataTrigger>
              <DataTrigger Binding="{Binding Status}" Value="En cours">
                <Setter Property="Background" Value="#27AE60" />
              </DataTrigger>
              <DataTrigger Binding="{Binding Status}" Value="Terminé">
                <Setter Property="Background" Value="#8E44AD" />
              </DataTrigger>
            </Style.Triggers>
          </Style>
        </Border.Style>
      </Border>
    </DataTemplate>
  </UserControl.Resources>

  <Grid Margin="20">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <!-- Messages -->
      <RowDefinition Height="Auto" />
      <!-- Titre -->
      <RowDefinition Height="Auto" />
      <!-- Filtres -->
      <RowDefinition Height="*" />
      <!-- Liste -->
      <RowDefinition Height="Auto" />
      <!-- Détails -->
    </Grid.RowDefinitions>


    <!-- Message d'erreur -->
    <Border Grid.Row="0" 
        Background="{StaticResource AccentBrush}"
        Padding="12"
        Margin="0,0,0,10"
        CornerRadius="4">
            <Border.Style>
                <Style TargetType="Border">
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding HasErrors}" Value="True">
                            <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>
            <TextBlock Text="{Binding ErrorMessages}" 
               Foreground="White"
               FontWeight="Bold"
               TextWrapping="Wrap"
            />
    </Border>

    <!-- Titre -->
    <TextBlock 
      Grid.Row="1"
      Text="Itinéraires des trains passagers"
      FontSize="22"
      FontWeight="Bold"
      Foreground="{StaticResource AccentBrush}"
      Margin="0,0,0,15"
    />

    <!-- Filtres -->
    <GroupBox Header="Filtres" Grid.Row="1" Margin="0,0,0,15">
      <StackPanel Orientation="Horizontal" Margin="10">
        <StackPanel Margin="10,0">
          <TextBlock Text="Date" Style="{StaticResource LabelStyle}" />
          <DatePicker SelectedDate="{Binding SelectedDate}" />
        </StackPanel>

        <StackPanel Margin="10,0">
          <TextBlock Text="Heure de départ" Style="{StaticResource LabelStyle}" />
          <TextBox Width="100" Text="{Binding DepartureTimeFilter}" />
        </StackPanel>

        <StackPanel Margin="10,0">
          <TextBlock Text="Destination finale" Style="{StaticResource LabelStyle}" />
          <TextBox Width="150" Text="{Binding DestinationFilter}" />
        </StackPanel>

        <Button
          Content="Rechercher"
          Margin="20,0,0,0"
          Background="{StaticResource AccentBrush}"
          Foreground="White"
          Command="{Binding SearchCommand}"
        />
      </StackPanel>
    </GroupBox>

    <!-- Liste des itinéraires -->
    <GroupBox Header="Itinéraires disponibles" Grid.Row="2">
      <DataGrid
        ItemsSource="{Binding TrainRoutes}"
        SelectedItem="{Binding SelectedRoute}"
        AutoGenerateColumns="False"
        CanUserAddRows="False"
        IsReadOnly="True"
        Background="{StaticResource LightBackground}"
        BorderBrush="{StaticResource AccentBrush}"
        Foreground="{StaticResource AccentBrush}"
        RowHeaderWidth="0"
        Margin="5"
      >
        <DataGrid.Columns>
          <DataGridTextColumn Header="Numéro de train" Binding="{Binding TrainNumber}" Width="*" />
          <DataGridTextColumn
            Header="Départ"
            Binding="{Binding DepartureTime, StringFormat=HH\\:mm}"
            Width="*"
          />
          <DataGridTextColumn
            Header="Arrivée"
            Binding="{Binding ArrivalTime, StringFormat=HH\\:mm}"
            Width="*"
          />
          <DataGridTextColumn
            Header="Stations intermédiaires"
            Binding="{Binding IntermediateStations}"
            Width="2*"
          />
          <DataGridTextColumn
            Header="Places disponibles"
            Binding="{Binding AvailableSeats}"
            Width="*"
          />
          <!-- Badge statut -->
          <DataGridTemplateColumn
            Header="Statut"
            Width="*"
            CellTemplate="{StaticResource StatusTemplate}"
          />
          <DataGridTextColumn
            Header="Tarif"
            Binding="{Binding Price, StringFormat={}{0:C}}"
            Width="*"
          />
        </DataGrid.Columns>
      </DataGrid>
    </GroupBox>

    <!-- Détails de l’itinéraire sélectionné -->
    <GroupBox Header="Détails de l’itinéraire" Grid.Row="3" Margin="0,15,0,0">
      <StackPanel Margin="10">
        <TextBlock Text="Numéro de train :" Style="{StaticResource LabelStyle}" />
        <TextBlock Text="{Binding SelectedRoute.TrainNumber}" />

        <TextBlock Text="Heure de départ :" Style="{StaticResource LabelStyle}" />
        <TextBlock Text="{Binding SelectedRoute.DepartureTime, StringFormat=HH\\:mm}" />

        <TextBlock Text="Heure d'arrivée :" Style="{StaticResource LabelStyle}" />
        <TextBlock Text="{Binding SelectedRoute.ArrivalTime, StringFormat=HH\\:mm}" />

        <TextBlock Text="Stations intermédiaires :" Style="{StaticResource LabelStyle}" />
        <TextBlock Text="{Binding SelectedRoute.IntermediateStations}" TextWrapping="Wrap" />

        <TextBlock Text="Destination finale :" Style="{StaticResource LabelStyle}" />
        <TextBlock Text="{Binding SelectedRoute.FinalDestination}" />

        <StackPanel Orientation="Horizontal" Margin="0,6,0,0">           
            <TextBlock Text="Disponibilité :" Style="{StaticResource LabelStyle}" Margin="0,0,8,0" />
               <Border CornerRadius="6" Padding="8,4">
                   <TextBlock Text="{Binding SelectedRoute.Status}" Foreground="White" FontWeight="Bold" />
                   <Border.Style>
                      <Style TargetType="Border">
                          <Setter Property="Background" Value="{StaticResource AccentBrush}" />
                          <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectedRoute.Status}" Value="Dernières places">
                                        <Setter Property="Background" Value="{StaticResource AccentBrush}" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding SelectedRoute.Status}" Value="Départ effectué">
                                  <Setter Property="Background" Value="{StaticResource AccentBrush}" />
                              </DataTrigger>
                          </Style.Triggers>
                      </Style>
                   </Border.Style>
               </Border>
        </StackPanel>

        <TextBlock Text="Places disponibles :" Style="{StaticResource LabelStyle}" />
        <TextBlock Text="{Binding SelectedRoute.AvailableSeats}" />

        <TextBlock Text="Tarif :" Style="{StaticResource LabelStyle}" />
        <TextBlock Text="{Binding SelectedRoute.Price, StringFormat={}{0:C}}" />

        <Button
          Content="Réserver"
          Margin="0,10,0,0"
          Background="{StaticResource AccentBrush}"
          Foreground="White"
          Command="{Binding ReserveCommand}"
          IsEnabled="{Binding SelectedRoute.CanReserve}"
        />
      </StackPanel>
    </GroupBox>
  </Grid>
</UserControl>
